<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Plateforme CCTP ‚Äî Domaines & Jeux</title>
<style>
  :root{--primary:#0a74da;--bg:#f4f7fb;--text:#22324a}
  *{box-sizing:border-box}body{font-family:Arial,Helvetica,sans-serif;margin:0;background:var(--bg);color:var(--text)}
  .container{max-width:1100px;margin:0 auto;padding:clamp(16px,4vw,32px)}
  .screen{display:none}.active{display:block}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:1rem}
  .card{background:#fff;border-radius:14px;box-shadow:0 10px 26px rgba(0,0,0,.08);padding:1rem}
  .btn{padding:.7rem 1.1rem;background:#0a74da;color:#fff;border:none;border-radius:10px;font-weight:700;cursor:pointer}
  .btn.secondary{background:#e9eef5;color:#1b304a}
  .hero{width:100%;max-width:980px;border-radius:16px;box-shadow:0 10px 26px rgba(0,0,0,.08);display:block;margin:0 auto 12px;object-fit:contain;max-height:60vh}
  .map{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1rem;margin-top:1rem}
  .location{background:#fff;padding:1rem;border-radius:14px;box-shadow:0 6px 18px rgba(0,0,0,.06);text-align:center;cursor:pointer}
  .overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;z-index:999}
  .overlay.active{display:block}.modal{position:fixed;top:5%;left:50%;transform:translateX(-50%);background:#fff;padding:clamp(16px,3vw,24px);border-radius:14px;box-shadow:0 18px 50px rgba(0,0,0,.25);display:none;z-index:1000;width:min(92vw,820px);max-height:90vh;overflow:auto}
  .modal.active{display:block}.modal img{max-width:100%;max-height:40vh;display:block;margin:0 auto .6rem}
  .info-log{margin-top:.6rem;color:#0f7a31}
  .tabs{display:flex;flex-wrap:wrap;gap:.5rem;margin-bottom:.8rem}
  .tab-btn{padding:.45rem .7rem;border-radius:10px;border:1px solid #d8e0ea;background:#fff;cursor:pointer;font-size:.92rem;color:#213347}
  .tab-btn.active{background:#0a74da;color:#fff;border-color:#0a74da}.tab-panel{display:none;background:#fff;padding:1rem;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,.06)}
  .tab-panel.active{display:block}
  .progress{height:10px;background:#e9eef5;border-radius:999px;overflow:hidden;margin:10px 0 18px}
  .progress>span{display:block;height:100%;background:#0a74da;width:0%}
  .option-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:.75rem;margin-top:.75rem}
  .option{border:1px solid #e6e6e6;border-radius:10px;padding:.75rem;background:#fafafa}
  .helper{font-size:.92rem;color:#526479;margin:.4rem 0 .1rem}
  .warn{color:#b54708;background:#fff7ed;padding:.5rem .75rem;border-radius:8px;border:1px solid #fde68a;display:none;margin-top:.5rem}
  .score{margin-top:12px;background:#f0f9ff;border:1px solid #bae6fd;color:#0c4a6e;padding:.75rem 1rem;border-radius:12px;font-weight:600;display:none}
  .badge{display:inline-block;padding:.35rem .6rem;border-radius:999px;font-size:.9rem;font-weight:700;margin-left:.5rem}
  .badge.debutant{background:#fff1f2;color:#be123c;border:1px solid #fecdd3}
  .badge.avance{background:#fff7ed;color:#b45309;border:1px solid #fed7aa}
  .badge.expert{background:#eff6ff;color:#1d4ed8;border:1px solid #93c5fd}
  .badge.genie{background:#ecfdf5;color:#065f46;border:1px solid #a7f3d0}
  .errors{margin-top:10px;background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:.75rem 1rem;display:none}
</style>
</head>
<body>
<script>
(function(){function show(id){var s=document.querySelectorAll('.screen');for(var i=0;i<s.length;i++)s[i].classList.remove('active');(document.getElementById(id)||document.getElementById('home')).classList.add('active');try{window.scrollTo(0,0);}catch(e){}}window.goTo=function(id){show(id);try{history.replaceState(null,'','#'+id);}catch(e){location.hash=id;}})();
</script>

<div id="home" class="screen active"><div class="container">
  <img class="hero" src="images/accueil_salle_formation.png" alt="">
  <h2>Choisissez votre domaine</h2>
  <div class="grid">
    <div class="card"><h3>Domaine Production</h3><p class="muted">LESATI</p><button class="btn" onclick="goTo('domain_production')">Acc√©der</button></div>
    <div class="card"><h3>Domaine R√©seau</h3><p class="muted">COPAYA</p><button class="btn" onclick="goTo('domain_reseau')">Acc√©der</button></div>
    <div class="card"><h3>Domaine Tertiaire</h3><p class="muted">TILESA</p><button class="btn" onclick="goTo('domain_tertiaire')">Acc√©der</button></div>
  </div>
</div></div>

<div id="domain_production" class="screen"><div class="container">
  <h2>Domaine Production ‚Äî LESATI</h2>
  <div class="grid">
    <div class="card"><h3>Jeu A ‚Äî Centrale Thermique (L√©a)</h3><button class="btn" onclick="goTo('game2_intro')">Lancer</button></div>
    <div class="card"><h3>Jeu B ‚Äî Centrale Hydraulique (L√©on)</h3><button class="btn" onclick="goTo('game3_intro')">Lancer</button></div>
  </div>
  <button class="btn secondary" onclick="goTo('home')">‚¨Ö Retour</button>
</div></div>

<div id="domain_reseau" class="screen"><div class="container">
  <h2>Domaine R√©seau ‚Äî COPAYA</h2>
  <div class="grid">
    <div class="card"><h3>Jeu A ‚Äî √âlagage</h3><button class="btn" onclick="goTo('game4_intro')">Lancer</button></div>
    <div class="card"><h3>Jeu B ‚Äî Raccordement HTA</h3><button class="btn" onclick="goTo('game5_intro')">Lancer</button></div>
  </div>
  <button class="btn secondary" onclick="goTo('home')">‚¨Ö Retour</button>
</div></div>

<div id="domain_tertiaire" class="screen"><div class="container">
  <h2>Domaine Tertiaire ‚Äî TILESA</h2>
  <div class="grid">
    <div class="card"><h3>Jeu A ‚Äî Nettoyage</h3><button class="btn" onclick="goTo('game1_intro')">Lancer</button></div>
    <div class="card"><h3>Jeu B ‚Äî V√©hicules √âlectriques</h3><button class="btn" onclick="goTo('game6_intro')">Lancer</button></div>
  </div>
  <button class="btn secondary" onclick="goTo('home')">‚¨Ö Retour</button>
</div></div>

<div id="game1_intro" class="screen"><div class="container"><img class="hero" src="images/tilesia_accueil_alex.png" alt=""><h2>TILESA ‚Äî Jeu A</h2><button class="btn" onclick="goTo('game1')">D√©marrer</button><button class="btn secondary" onclick="goTo('domain_tertiaire')">‚¨Ö Retour</button></div></div>
<div id="game2_intro" class="screen"><div class="container"><img class="hero" src="images/lea_centrale_LESATI.png" alt=""><h2>LESATI ‚Äî Jeu A</h2><button class="btn" onclick="goTo('game2')">D√©marrer</button><button class="btn secondary" onclick="goTo('domain_production')">‚¨Ö Retour</button></div></div>
<div id="game3_intro" class="screen"><div class="container"><img class="hero" src="images/leon_centrale_LESATI.png" alt=""><h2>LESATI ‚Äî Jeu B</h2><button class="btn" onclick="goTo('game3')">D√©marrer</button><button class="btn secondary" onclick="goTo('domain_production')">‚¨Ö Retour</button></div></div>
<div id="game4_intro" class="screen"><div class="container"><img class="hero" src="images/copaya_accueil.png" alt=""><h2>COPAYA ‚Äî Jeu A</h2><button class="btn" onclick="goTo('game4')">D√©marrer</button><button class="btn secondary" onclick="goTo('domain_reseau')">‚¨Ö Retour</button></div></div>
<div id="game5_intro" class="screen"><div class="container"><img class="hero" src="images/copaya_intro.png" alt=""><h2>COPAYA ‚Äî Jeu B</h2><button class="btn" onclick="goTo('game5')">D√©marrer</button><button class="btn secondary" onclick="goTo('domain_reseau')">‚¨Ö Retour</button></div></div>
<div id="game6_intro" class="screen"><div class="container"><img class="hero" src="images/accueil_sabrina.png" alt=""><h2>TILESA ‚Äî Jeu B</h2><button class="btn" onclick="goTo('game6')">D√©marrer</button><button class="btn secondary" onclick="goTo('domain_tertiaire')">‚¨Ö Retour</button></div></div>

<div id="game1" class="screen"><div class="container"><h2>TILESA ‚Äî Jeu A</h2>
  <div class="map">
    <div class="location" onclick="openModal('Direction',1)">Direction</div>
    <div class="location" onclick="openModal('Technique',1)">Technique</div>
    <div class="location" onclick="openModal('Salaries',1)">Salari√©s</div>
    <div class="location" onclick="openModal('Juridique',1)">Juridique</div>
  </div>
  <div class="info-log" id="infoLog1"></div>
  <div style="margin-top:10px;display:flex;gap:.5rem;flex-wrap:wrap">
    <button class="btn" onclick="startBuilder(1,true)">R√©diger le cahier des charges</button>
    <button class="btn secondary" onclick="goTo('domain_tertiaire')">‚¨Ö Retour</button>
  </div>
</div></div>

<div id="game2" class="screen"><div class="container"><h2>LESATI ‚Äî Jeu A</h2>
  <div class="map">
    <div class="location" onclick="openModal('Direction',2)">Direction</div>
    <div class="location" onclick="openModal('Service production',2)">Service production</div>
    <div class="location" onclick="openModal('Salaries',2)">Salari√©s</div>
    <div class="location" onclick="openModal('Juridique',2)">Juridique</div>
  </div>
  <div class="info-log" id="infoLog2"></div>
  <button class="btn secondary" onclick="goTo('domain_production')">‚¨Ö Retour</button>
</div></div>

<div id="game3" class="screen"><div class="container"><h2>LESATI ‚Äî Jeu B</h2>
  <div class="map">
    <div class="location" onclick="openModal('Direction B',3)">Direction</div>
    <div class="location" onclick="openModal('Manager',3)">Manager</div>
    <div class="location" onclick="openModal('Maintenance',3)">Maintenance</div>
    <div class="location" onclick="openModal('Juridique B',3)">Juridique</div>
    <div class="location" onclick="openModal('S√©curit√©',3)">S√©curit√©</div>
  </div>
  <div class="info-log" id="infoLog3"></div>
  <div style="margin-top:10px;display:flex;gap:.5rem;flex-wrap:wrap">
    <button class="btn" onclick="startBuilder(3,true)">R√©diger le cahier des charges</button>
    <button class="btn secondary" onclick="goTo('domain_production')">‚¨Ö Retour</button>
  </div>
</div></div>

<div id="game4" class="screen"><div class="container"><h2>COPAYA ‚Äî Jeu A</h2>
  <div class="map">
    <div class="location" onclick="openModal('Direction Copaya',4)">Direction</div>
    <div class="location" onclick="openModal('Clients Copaya',4)">Clients</div>
    <div class="location" onclick="openModal('Maintenance Copaya',4)">Maintenance</div>
    <div class="location" onclick="openModal('Environnement Copaya',4)">Environnement</div>
    <div class="location" onclick="openModal('S√©curit√© Copaya',4)">S√©curit√©</div>
  </div>
  <div class="info-log" id="infoLog4"></div>
  <div style="margin-top:10px;display:flex;gap:.5rem;flex-wrap:wrap">
    <button class="btn" onclick="startBuilder(4,true)">R√©diger le cahier des charges</button>
    <button class="btn secondary" onclick="goTo('domain_reseau')">‚¨Ö Retour</button>
  </div>
</div></div>

<div id="game5" class="screen"><div class="container"><h2>COPAYA ‚Äî Jeu B</h2>
  <div class="map">
    <div class="location" onclick="openModal('Directrice Carl',5)">La Directrice</div>
    <div class="location" onclick="openModal('√âquipe Carl',5)">√âquipe</div>
    <div class="location" onclick="openModal('Manager Carl',5)">Manager</div>
    <div class="location" onclick="openModal('Habitants Carl',5)">Habitants</div>
    <div class="location" onclick="openModal('Juriste Carl',5)">Juriste</div>
    <div class="location" onclick="openModal('Pr√©vention Carl',5)">Pr√©vention</div>
  </div>
  <div class="info-log" id="infoLog5"></div>
  <div style="margin-top:10px;display:flex;gap:.5rem;flex-wrap:wrap">
    <button class="btn" onclick="startBuilder(5,true)">R√©diger le cahier des charges</button>
    <button class="btn secondary" onclick="goTo('domain_reseau')">‚¨Ö Retour</button>
  </div>
</div></div>

<div id="game6" class="screen"><div class="container"><h2>TILESA ‚Äî Jeu B</h2>
  <div class="map">
    <div class="location" onclick="openModal('Direction Tilesa B',6)">Direction</div>
    <div class="location" onclick="openModal('Juriste Tilesa B',6)">Juriste</div>
    <div class="location" onclick="openModal('Manager Tilesa B',6)">Manager</div>
    <div class="location" onclick="openModal('Services Tilesa B',6)">Services</div>
    <div class="location" onclick="openModal('Technique Tilesa B',6)">Technique</div>
    <div class="location" onclick="openModal('Environnement Tilesa B',6)">Responsable environnement</div>
  </div>
  <div class="info-log" id="infoLog6"></div>
  <div style="margin-top:10px;display:flex;gap:.5rem;flex-wrap:wrap">
    <button class="btn" onclick="startBuilder(6,true)">R√©diger le cahier des charges</button>
    <button class="btn secondary" onclick="goTo('domain_tertiaire')">‚¨Ö Retour</button>
  </div>
</div></div>

<div class="overlay" id="overlay" onclick="closeModal()"></div>
<div class="modal" id="modal"><h3 id="modalTitle"></h3><img id="modalImage" src="" alt=""><p id="modalText"></p>
  <div style="display:flex;gap:.5rem;margin-top:.7rem">
    <button class="btn" onclick="collectInfo()">Collecter l'information</button>
    <button class="btn secondary" onclick="closeModal()">Retour</button>
  </div>
</div>

<div id="builder" class="screen"><div class="container" id="builderContainer"></div></div>
<div id="summary" class="screen"><div class="container" id="summaryContainer"></div></div>

<script>
/* Donn√©es d'origine */
const data1={
  'Direction':{ text:"Le pr√©sident vous accueille : ¬´ La sant√© et la s√©curit√© sont mes priorit√©s pour garantir le bon fonctionnement de l‚Äôentreprise et le bien-√™tre des salari√©s. ¬ª", image:"images/tilesia_direction.png" },
  'Technique':{ text:`Intervention pendant les heures ouvrables, sauf cas exceptionnel. Pour les locaux √©lectriques, le titulaire sera accompagn√© d'un employ√© disposant des habilitations requises.

Les espaces concern√©s sont les suivants : bureaux, couloirs, escaliers, ascenseur, sanitaires, vestiaires, r√©fectoires.

Le titulaire remplira un avis de passage. Le rapport semestriel sera r√©dig√© par le service technique.

Les consommables √† la charge du prestataire sont les suivants :
- Le papier toilette
- Le papier essuie-mains
- Le savon liquide √† mains
- Les sacs poubelles
- D√©sodorisants.`, image:"images/tilesia_technique.png" },
  'Salaries':{ text:"Il y a 300 salari√©s dans le b√¢timent r√©partis sur les 4 √©tages. Le b√¢timent dispose d‚Äôune superficie de 4100 m¬≤. Vous observez une ambiance de coop√©ration et de r√©unions dans les locaux.", image:"images/tilesia_salaries.png" },
  'Juridique':{ text:"La juriste rappelle les prescriptions du D√©cret 92-158 du 20 f√©vrier 1992 reprises dans le Code du travail (articles R.237-1 et R.237-28), applicables aux travaux r√©alis√©s dans l‚Äô√©tablissement par une entreprise ext√©rieure.", image:"images/tilesia_juridique.png" }
};
const data2={
  'Direction':{ text:'La directrice : "LESATI assure production, distribution et commercialisation √† Saint Georges (800 clients). Priorit√© au service public et √† la proximit√© client."', image:"images/direction_directrice_LESATI.png" },
  'Service production':{ text:'Certains groupes ont atteint leurs limites techniques (...) \n\nNous aurons besoins de 3 groupes √©lectrog√®nes d‚Äôune puissance nominale de 800 kVA, de type diesel avec les certifications "Ultra" et "Iso 9001". Il faut penser aux documents n√©cessaires pour la bonne utilisation du mat√©riel.', image:"images/production_groupes_LESATI.png" },
  'Salaries':{ text:"Les 30 salari√©s devant l‚Äôentr√©e du b√¢timent principal. Ils sont pleinement investis (...).", image:"images/salaries_30_LESATI.png" },
  'Juridique':{ text:"La juriste rappelle qu'il est indispensable d'ajouter une garantie technique lors de l'achat des groupes √©lectrog√®nes, avec livraison √† Saint Georges. Les groupes seront utilis√©s en continu dans un milieu humide et avec temp√©rature √©lev√©e.", image:"images/juridique_garantie_LESATI.png" }
};
const data3={
  'Direction B':{ text:`Pour r√©pondre aux besoins √©nerg√©tiques croissants de la Guyane au d√©but des ann√©es 1980, le barrage a √©t√© construit au niveau d‚Äôun resserrement naturel du fleuve Sinnamary. Gr√¢ce √† sa retenue d‚Äôeau, il alimente deux tiers des foyers du littoral guyanais.`, image:"images/direction_LESATI_B.png" },
  'Manager':{ text:`Ce cahier des charges a pour objet la fourniture d‚Äô√©quipements destin√©s √† l‚Äôexploitation et √† la maintenance d‚Äôune centrale hydraulique (Sinnamary). Ces √©quipements doivent r√©pondre aux exigences de performance, de durabilit√©, et de conformit√© aux normes en vigueur.`, image:"images/manager_LESATI_B.png" },
  'Maintenance':{ text:`Les pi√®ces de rechange sont utilis√©es sur les √©quipements suivants :

- Les pompes,
- Les moteurs √©lectriques,
- Les kits de maintenance des pompes,
- Les capteurs analogiques et tout ou rien de niveaux, pressostats, manom√®tres, 
- Les filtres,
- Les clapets anti-retour,
- Les vannes manuelles et motoris√©es,
- Les actionneurs (ex. √©lectrovannes).

Les livrables attendus sont les suivants :

- L‚Äôensemble des √©quipements, accompagn√©s de leurs certificats de conformit√©, notices techniques, plans d'installation si n√©cessaire.
- Rapport d‚Äôessais.`, image:"images/maintenance_LESATI_B.png" },
  'Juridique B':{ text:`Le titulaire garantit les fournitures contre tout d√©faut de fabrication ou de mati√®re pour une dur√©e minimale de 24 mois √† compter de la date de mise en service ou 30 mois apr√®s la livraison. En cas de d√©faillance, le remplacement ou la r√©paration des √©quipements sera pris en charge par le Titulaire.`, image:"images/juridique_LESATI_B.png" },
  'S√©curit√©':{ text:`Les √©quipements devront √™tre livr√©s avec protections contre l‚Äôhumidit√© et les chocs. Une √©tiquette claire indiquant le contenu et la r√©f√©rence doit √™tre visible sur chaque caisse.

Adresse du site :
Centrale hydraulique de Sinnamary
97315 Sinnamary
Guyane Fran√ßaise

Horaires de livraison :
Du lundi au vendredi de 08h00 √† 12h00`, image:"images/securite_LESATI_B.png" }
};
const data4={
  'Direction Copaya':{ text:`L'√©lagage est essentiel pour pr√©venir les coupures d'√©lectricit√© et assurer la continuit√© de l'alimentation √©lectrique des clients. Copaya supervise l'√©lagage des arbres √† proximit√© des lignes √©lectriques pour √©viter les dommages sur le r√©seau.`, image:"images/copaya_direction.png" },
  'Clients Copaya':{ text:`Les propri√©taires de terrain doivent veiller √† l'entretien et √† la taille r√©guli√®re des arbres situ√©s sur leurs propri√©t√©s, conform√©ment √† la r√©glementation. L‚Äô√©lagage √† proximit√© des r√©seaux √©lectriques doit √™tre g√©r√© par des professionnels disposant d‚Äôune autorisation AIPR (Autorisation Intervention √† Proximit√© des R√©seaux). La pousse rapide de la v√©g√©tation peut engendrer des probl√©matiques de s√©curit√© des tiers et √©galement des coupures intempestives de la client√®le.`, image:"images/clients_copaya.png" },
  'Maintenance Copaya':{ text:`Distances attendues :

- 405 KM √† √©laguer par an sur le r√©seau HTA
- 250 KM √† √©laguer par an sur le r√©seau HTB
- 100 pieds de support par an + acc√®s

Nous souhaitons un compte rendu pr√©cis de chaque zone √©lagu√©e. 
Le compte rendu est agr√©ment√© de photos avant et apr√®s passage du Titulaire.

Les proc√©dures d‚Äôacc√®s et les plans seront fournis par Copaya.
Les documents d‚Äôacc√®s sont de la responsabilit√© de Copaya.

Les chantiers se r√©aliseront de pr√©f√©rence entre 6h30 et 17h00. 
Tout chantier planifi√© en dehors de ces horaires sera r√©alis√© avec l‚Äôaccord √©crit de Copaya.

Avant toute intervention √† proximit√© d‚Äôun ouvrage √©lectrique, il est imp√©ratif d‚Äôenvoyer une DT-DICT (D√©claration de Travaux - D√©claration d‚ÄôIntention de Commencement de Travaux) au moins 15 jours avant le d√©but des travaux.`, image:"images/copaya_maintenance.png" },
  'Environnement Copaya':{ text:`l‚Äôintervention dans des zones prot√©g√©es, la pr√©servation des esp√®ces (p√©riodes de nidification, par exemple) et la gestion des risques d‚Äôincendie sont encadr√©es par une r√©glementation qui √©volue, en m√™me temps que la prise de conscience environnementale`, image:"images/copaya_environnement.png" },
  'S√©curit√© Copaya':{ text:`Le Titulaire devra s‚Äô√©quiper d'Equipements de Protection Collectifs (EPC) et d‚ÄôEquipements de Protection Individuels (EPI), √† savoir :
- Balisage des zones de travail avec c√¥nes pour mat√©rialiser la zone de travail sur route
- Gyrophare/voyants lumineux
- Panneaux de chantier pos√©s a minima 50m avant le chantier
- Casque
- Gants de manutention
- Protection auditive
- V√™tement de protection
- Chaussures de s√©curit√©
- Mat√©riel d‚Äôascension conforme (contr√¥le m√©trologique √† jour)`, image:"images/copaya_securite.png" }
};
const data5={
  'Directrice Carl':{ 
    text:`Ce projet est d‚Äôune grande importance pour l‚Äôentreprise COPAYA. Nous voulons fournir la m√™me qualit√© de service √† l‚Äôensemble des habitants pr√©sents sur le territoire. Tous les moyens seront mis en ≈ìuvre pour respecter les d√©lais et limiter les nuisances. Il est important de finaliser les travaux avant la prochaine saison des pluies.`,
    image:"images/copaya_directrice.png"
  },
  '√âquipe Carl':{
    text:`Le titulaire transmettra son planning permettant de r√©aliser la fiche de d√©roulement des op√©rations (FDO).
Les communications seront r√©alis√©es via un outil dont les modalit√©s de connexion seront transmises ult√©rieurement.
Copaya fournira les c√¢bles, la bo√Æte de jonction et un local de stockage tandis que le Titulaire devra nous transmettre les chambres de tirage.`,
    image:"images/copaya_equipe.png"
  },
  'Manager Carl':{
    text:`Voici les consignes :

- Mise en souterrain de 20 km de r√©seau HTA et 15 km de fibres optiques
- Confection de 60 bo√Ætes de jonction HTA
- Fourniture et pose de fourreaux
- R√©alisation d‚Äôune fouille pour la pose d‚Äôune armoire
- R√©alisation d‚Äôune dalle de propret√© autour de l‚Äôarmoire
- Installation et mise en service de l‚Äôarmoire
- Raccordement et √©tiquetage des c√¢bles HTA
- Dur√©e du chantier : 4 mois`,
    image:"images/copaya_manager.png"
  },
  'Habitants Carl':{
    text:`Nous attendons ces travaux avec impatience. Ces travaux permettront de stabiliser le r√©seau √©lectrique. Nous esp√©rons que les impacts sur la chauss√©e et sur le volume sonore seront minimis√©s dans le quartier.`,
    image:"images/copaya_habitants.png"
  },
  'Juriste Carl':{
    text:`Les tranch√©es devront respecter les conditions impos√©es par la DGTM (Direction G√©n√©rale des Territoires et de la Mer) concernant les travaux pr√©vus sur la voie publique.
Avant tous travaux sur le domaine public, le prestataire devra effectuer une d√©claration de commencement de travaux. Avant l‚Äôouverture du chantier, il transmettra les √©l√©ments au Ma√Ætre d‚ÄôOuvrage.
Le Titulaire r√©alisera l‚Äôensemble des investigations compl√©mentaires (IC) et op√©rations de localisation (OL) n√©cessaires √† l‚Äôex√©cution des travaux conform√©ment au d√©cret n¬∞2011-12.`,
    image:"images/copaya_juriste.png"
  },
  'Pr√©vention Carl':{
    text:`Le Titulaire devra prendre toutes les dispositions n√©cessaires pour assurer la s√©curit√© des biens et des personnes :

- Balisage des zones de travail avec c√¥nes pour mat√©rialiser la zone de travail sur route 
- Gyrophare/voyants lumineux 
- Panneaux de chantier pos√©s a minima 50 m avant le chantier
 
Des visites r√©guli√®res de pr√©vention s√©curit√© seront organis√©es par COPAYA pour s‚Äôassurer de la conformit√© du chantier.`,
    image:"images/copaya_prevention.png"
  }
};
const data6={
  'Direction Tilesa B':{ 
    text:`Dans le cadre de son engagement en faveur du d√©veloppement durable et de la r√©duction des √©missions de gaz √† effet de serre, Tilesa souhaite √©lectrifier sa flotte de v√©hicules en Guyane Fran√ßaise. La flotte actuelle compte 150 v√©hicules dont 30% doivent √™tre remplac√©s par des mod√®les √©lectriques.`,
    image:"images/direction.png" 
  },
  'Manager Tilesa B':{ 
    text:`Le Titulaire du march√© devra assurer :

- La fourniture de v√©hicules √©lectriques neufs, homologu√©s pour le territoire fran√ßais et adapt√©s √† l‚Äôenvironnement guyanais 
- La livraison des v√©hicules sur les diff√©rents sites : Cayenne, Kourou, Saint-Laurent-du-Maroni‚Ä¶
- La mise en service compl√®te (immatriculation locale, premi√®re charge, v√©rifications fonctionnelles) 
- La formation des utilisateurs √† la conduite de v√©hicules √©lectriques 
- La fourniture de la documentation compl√®te (certificats de conformit√©, manuels, garanties)
- Le service apr√®s-vente assur√© localement ou via un partenaire agr√©√© en Guyane.
- Les v√©hicules seront livr√©es lors des jours d‚Äôouverture des sites`,
    image:"images/manager.png" 
  },
  'Services Tilesa B':{ 
    text:`Trois coll√®gues √©changent sur les besoins :

- Service r√©seau : V√©hicules tout-chemin √©lectriques ou hybrides rechargeables pour zones d‚Äôacc√®s difficile.
- Client√®le :  Petits utilitaires √©lectriques pour transport de mat√©riel et d‚Äô√©quipes techniques
- Finance : Berlines ou citadines √©lectriques pour d√©placements professionnels`,
    image:"images/services.png" 
  },
  'Technique Tilesa B':{ 
    text:`Le Titulaire prendra en charge :

- Les frais d‚Äôacheminement jusqu‚Äôen Guyane (transport maritime, douane, manutention, livraison finale)
- Les formalit√©s administratives d‚Äôimmatriculation sur le territoire
- La fourniture de tous les √©quipements de base (c√¢bles de recharge, kit s√©curit√©, roue de secours ou kit anti-crevaison)

L‚Äôentreprise assurera :
- La mise √† disposition des emplacements n√©cessaires √† la r√©ception et au stationnement des v√©hicules
- L‚Äôassurance des v√©hicules
- L‚Äôinstallation et l‚Äôentretien des bornes de recharge
- Le suivi administratif (cartes grises, fiscalit√©, contr√¥les p√©riodiques)`,
    image:"images/technique.png" 
  },
  'Juriste Tilesa B':{ 
    text:`Face √† l‚Äôurgence climatique, l‚ÄôUnion europ√©enne a mis en place un cadre r√©glementaire ambitieux pour acc√©l√©rer l‚Äô√©lectrification du parc automobile.  Parmi les mesures phares :

- l‚Äôinterdiction de la vente des voitures thermiques neuves √† partir de 2035
- la norme CAFE, le recyclage des batteries et la mise en place d‚Äôun passeport num√©rique de batterie.`,
    image:"images/juriste.png" 
  },
  'Environnement Tilesa B':{ 
    text:`Nos objectifs sont les suivants :
- R√©duction mesurable des √©missions de CO‚ÇÇ et des co√ªts √©nerg√©tiques
- Am√©lioration du confort de conduite et de la s√©curit√© des utilisateurs
- Fonctionnement optimal des v√©hicules malgr√© les contraintes territoriales.`,
    image:"images/responsable_environnement.png" 
  }
};

let currentGame=0,currentKey='';const sets={1:new Set(),2:new Set(),3:new Set(),4:new Set(),5:new Set(),6:new Set()};
function openModal(key,game){currentGame=game;currentKey=key;const src=game===2?data2:game===3?data3:game===4?data4:game===5?data5:game===6?data6:data1;const it=src[key];document.getElementById('modalTitle').textContent=key;document.getElementById('modalImage').src=it.image;document.getElementById('modalText').textContent=it.text;document.getElementById('overlay').classList.add('active');document.getElementById('modal').classList.add('active');}
function closeModal(){document.getElementById('overlay').classList.remove('active');document.getElementById('modal').classList.remove('active');}
function collectInfo(){const set=sets[currentGame];set.add(currentKey);const el=document.getElementById('infoLog'+currentGame);if(el)el.textContent="Infos collect√©es : "+Array.from(set).join(', ');closeModal();}

/* Aides (identiques) */
const helpByStep={objet:"D√©finir l‚Äôobjet du cahier des charges (rien d‚Äôautre).",contexte:"Situer le contexte (enjeux, historique, politique d‚Äôentreprise).",definition:"D√©crire pr√©cis√©ment la prestation et sa volum√©trie.",limites_titulaire:"Ce qui est explicitement √† la charge du Titulaire.",limites_entreprise:"Ce qui reste √† la charge de l‚Äôentreprise.",qualite:"Exigences de qualit√©, normes, tra√ßabilit√©.",conditions:"Acc√®s, s√©curit√©, d√©lais, pr√©cautions.",resultats:"R√©sultats mesurables et contr√¥lables.",reception_ref:"Crit√®res, livrables et modalit√©s de r√©ception."};

/* QCM (5 jeux) */
function stepsFor(gameId){
  switch(gameId){
    case 4: return [
      {id:"objet",label:"Objet",help:helpByStep.objet,options:["√âlagage de la v√©g√©tation autour des ouvrages √©lectriques HTA/HTB","Maintenance pr√©ventive des lignes issues du poste √âtoile jusqu‚Äôau poste Margot","R√©alisation d‚Äôune visite pr√©alable avec COPAYA avant les travaux","Fourniture d‚Äô√©quipements √©lectriques haute tension","Construction d‚Äôun nouveau poste √©lectrique"]},
      {id:"contexte",label:"Contexte",help:helpByStep.contexte,options:["Pousse rapide de la v√©g√©tation en Guyane","Risques de coupures intempestives pour la client√®le","Risques de s√©curit√© pour les tiers","Modernisation des r√©seaux fibre optique","Projet li√© √† l‚Äôaugmentation des besoins touristiques"]},
      {id:"definition",label:"D√©finition de la prestation",help:helpByStep.definition,options:["√âlagage manuel","√âlagage au bulldozer","√âlagage au gyrobroyeur","Gestion des acc√®s aux pieds de support","Pose de c√¢bles HTA","405 km √† √©laguer sur le r√©seau HTA","250 km √† √©laguer sur le r√©seau HTB","100 pieds de support + acc√®s"]},
      {id:"limites_titulaire",label:"Limites √† la charge du titulaire",help:helpByStep.limites_titulaire,options:["Organiser les moyens humains et mat√©riels n√©cessaires","R√©aliser l‚Äô√©lagage et l‚Äôacc√®s aux pieds de support","Transmettre un planning apr√®s la visite pr√©alable avec COPAYA"]},
      {id:"limites_entreprise",label:"Limites √† la charge de l‚Äôentreprise",help:helpByStep.limites_entreprise,options:["Fourniture des plans et proc√©dures d'acc√®s","Accompagnement lors de la visite pr√©alable","Fourniture du personnel d‚Äô√©lagage","Mise √† disposition du mat√©riel d‚Äôascension"]},
      {id:"qualite",label:"Qualit√©",help:helpByStep.qualite,options:["Photos avant / apr√®s intervention","Rapport pr√©cis de chaque zone √©lagu√©e","Respect du d√©cret du 20 f√©vrier 1992","Certification ISO obligatoire"]},
      {id:"conditions",label:"Conditions d‚Äôintervention",help:helpByStep.conditions,options:["Interventions pr√©f√©rentiellement entre 6h30 et 17h","DT-DICT envoy√©e 15 jours avant travaux","Inspection commune pr√©alable obligatoire","Travaux en zone prot√©g√©e soumis √† r√©glementation environnementale","Travaux uniquement la nuit","Intervention sans pr√©venir COPAYA"]},
      {id:"resultats",label:"R√©sultats attendus",help:helpByStep.resultats,options:["Continuit√© de l‚Äôalimentation √©lectrique","Suppression des risques de court-circuit d√ª aux v√©g√©taux","Diminution des coupures intempestives","Installation de nouveaux √©quipements HTA"]},
      {id:"reception_ref",label:"R√©ception",help:helpByStep.reception_ref,options:["Signature d‚Äôun rapport de visite pr√©alable par les deux parties","COPAYA peut refuser un chantier non conforme","Photos justificatives obligatoires pour validation","R√©ception automatique sans contr√¥le"]}
    ];
    case 5: return [
      {id:"objet",label:"Objet",help:helpByStep.objet,options:["Raccordement au r√©seau √©lectrique d'un village situ√© en Guyane Fran√ßaise","R√©alisation de fouilles et de dalles de propret√©","Stabilisation du r√©seau √©lectrique pour les habitants","Respect des normes HTA et DT/DICT"]},
      {id:"contexte",label:"Contexte",help:helpByStep.contexte,options:["Projet prioritaire pour maintenir le service public d‚Äô√©lectricit√©","Limiter les nuisances et finaliser les travaux avant la saison des pluies","Attentes fortes des habitants concernant la qualit√© du r√©seau","Projet pr√©vu uniquement pour augmenter la capacit√© de production locale"]},
      {id:"definition",label:"D√©finition de la prestation",help:helpByStep.definition,options:["Mise en souterrain de 20 km de r√©seau HTA et 15 km de fibre optique","Installation et mise en service d‚Äôarmoires √©lectriques & raccordements HTA","Confection de 60 bo√Ætes de jonction HTA et fourniture/pose de fourreaux","Travaux de d√©boisement et construction de logements temporaires"]},
      {id:"limites_titulaire",label:"Limites √† la charge du titulaire",help:helpByStep.limites_titulaire,options:["R√©alisation des fouilles et dalle de propret√©","Raccordement, √©tiquetage c√¢bles HTA et transmission chambres de tirage","Respect du balisage, panneaux, gyrophare et s√©curit√© chantier","Fourniture des c√¢bles et des bo√Ætes de jonction"]},
      {id:"limites_entreprise",label:"Limites √† la charge de l‚Äôentreprise",help:helpByStep.limites_entreprise,options:["Fourniture des c√¢bles","Fourniture des bo√Ætes de jonction","Mise √† disposition d‚Äôun local de stockage","Fourniture des chambres de tirage"]},
      {id:"qualite",label:"Qualit√©",help:helpByStep.qualite,options:["Travaux r√©alis√©s dans les d√©lais pour √©viter la saison des pluies","Respect des normes techniques HTA et DT/DICT","Limitation des nuisances (bruit, circulation)","Interventions uniquement de nuit pour limiter les impacts urbains"]},
      {id:"conditions",label:"Conditions d‚Äôintervention",help:helpByStep.conditions,options:["Transmission d‚Äôun planning permettant d‚Äô√©tablir la FDO","Visites r√©guli√®res de pr√©vention s√©curit√© organis√©es par COPAYA","Communication via l‚Äôoutil COPAYA d√©di√©","Intervention uniquement durant les week-ends"]},
      {id:"resultats",label:"R√©sultats attendus",help:helpByStep.resultats,options:["R√©seau souterrain op√©rationnel et fiable pour les habitants","Stabilisation du r√©seau et r√©duction du risque de coupures","Travaux conformes aux prescriptions r√©glementaires et techniques","Production d‚Äô√©lectricit√© accrue dans la r√©gion"]},
      {id:"reception_ref",label:"R√©ception",help:helpByStep.reception_ref,options:["Contr√¥le des travaux par COPAYA","R√©ception apr√®s conformit√© r√©glementaire DGTM & IC/OL","V√©rification des installations HTA et fibre avant mise en service","R√©ception automatique apr√®s fin de chantier"]}
    ];
    case 6: return [
      {id:"objet",label:"Objet",help:helpByStep.objet,options:["Achat de v√©hicules √©lectriques neufs pour renouveler la flotte de Tilesa","Remplacement des bornes de recharge existantes","Achat de v√©los √©lectriques pour les √©quipes","Maintenance du r√©seau fibre optique"]},
      {id:"contexte",label:"Contexte",help:helpByStep.contexte,options:["Tilesa souhaite √©lectrifier sa flotte pour r√©duire son impact environnemental","Tilesa souhaite uniquement augmenter la vitesse de ses v√©hicules","La flotte actuelle est d√©j√† 100% √©lectrique","Le projet r√©pond aux engagements climatiques europ√©ens"]},
      {id:"definition",label:"D√©finition de la prestation",help:helpByStep.definition,options:["Fourniture de v√©hicules √©lectriques adapt√©s √† la Guyane","Livraison sur plusieurs sites (Cayenne, Kourou, Saint-Laurent‚Ä¶)","Formation des utilisateurs √† la conduite des VE","Achat de v√©hicules thermiques hybrides rechargeables uniquement"]},
      {id:"limites_titulaire",label:"Limites √† la charge du titulaire",help:helpByStep.limites_titulaire,options:["Acheminement jusqu'en Guyane, douane & livraison finale","Formalit√©s d'immatriculation locale","Service apr√®s-vente local ou agr√©√©","Assurance des v√©hicules"]},
      {id:"limites_entreprise",label:"Limites √† la charge de l‚Äôentreprise",help:helpByStep.limites_entreprise,options:["Mise √† disposition des emplacements & stationnement","Assurance des v√©hicules","Installation des bornes de recharge","Fourniture des v√©hicules thermiques de secours"]},
      {id:"qualite",label:"Qualit√©",help:helpByStep.qualite,options:["V√©hicules adapt√©s au climat et aux routes locales","Documentation compl√®te & garanties","Pas besoin de SAV local","V√©hicules test√©s avant livraison"]},
      {id:"conditions",label:"Conditions d‚Äôintervention",help:helpByStep.conditions,options:["Livraison uniquement en jours ouvr√©s","V√©rification fonctionnelle √† la r√©ception","Livraison libre sans prise de rendez-vous","Livraison uniquement sur Cayenne"]},
      {id:"resultats",label:"R√©sultats attendus",help:helpByStep.resultats,options:["R√©duction mesurable des √©missions CO‚ÇÇ","Am√©lioration du confort des utilisateurs","Fonctionnement optimal malgr√© contraintes territoriales","R√©duction du nombre de sites op√©rationnels"]},
      {id:"reception_ref",label:"R√©ception",help:helpByStep.reception_ref,options:["Remise de la documentation compl√®te","V√©rification fonctionnelle & premi√®re charge","Acceptation automatique sans contr√¥le","Enregistrement administratif conforme"]}
    ];
    case 3: return [
      {id:"objet",label:"Objet",help:helpByStep.objet,options:["Fourniture d‚Äô√©quipements destin√©s √† l‚Äôexploitation et √† la maintenance d‚Äôune centrale hydraulique","Achat de pompes et de moteurs","Maintenance de la centrale hydraulique","Achat d'√©quipements pour centrale de production"]},
      {id:"contexte",label:"Contexte",help:helpByStep.contexte,options:["Le barrage de Petit Saut a √©t√© construit au niveau du fleuve Sinnamary","La mise en service a eu lieu en 1994","La retenue d‚Äôeau de 310 km¬≤ alimente deux tiers des foyers du littoral","Ce projet concerne une installation industrielle hors Guyane"]},
      {id:"definition",label:"D√©finition de la prestation",help:helpByStep.definition,options:["Fourniture de pi√®ces de rechange pour pompe et √©quipements hydrauliques","Fourniture des √©quipements conformes aux normes en vigueur","Fourniture de syst√®mes d‚Äôair conditionn√©","Fourniture d‚Äô√©quipements pour centrale photovolta√Øque"]},
      {id:"limites_titulaire",label:"Limites √† la charge du titulaire",help:helpByStep.limites_titulaire,options:["Remplacement ou r√©paration en cas de d√©faillance","Livraison dans les conditions sp√©cifi√©es","Pr√©venir l‚Äôentreprise 21 jours avant la livraison","Fourniture des documents techniques","Le titulaire peut livrer sans emballage"]},
      {id:"limites_entreprise",label:"Limites √† la charge de l‚Äôentreprise",help:helpByStep.limites_entreprise,options:["Le transport et le d√©chargement sont √† la charge du titulaire","L‚Äôentreprise prend en charge le d√©chargement des colis","L‚Äôentreprise g√®re l'assurance transport","L‚Äôentreprise fournit les pi√®ces si n√©cessaire"]},
      {id:"qualite",label:"Qualit√©",help:helpByStep.qualite,options:["Certificats de conformit√©","Notices techniques","Plans d‚Äôinstallation si n√©cessaire","Rapport d‚Äôessais","Aucune documentation fournie"]},
      {id:"conditions",label:"Conditions d‚Äôintervention",help:helpByStep.conditions,options:["Livraison du lundi au vendredi de 08h00 √† 12h00","Livraison possible uniquement de nuit","Emballage avec protection contre l'humidit√© et les chocs","√âtiquetage clair et de r√©f√©rence"]},
      {id:"resultats",label:"R√©sultats attendus",help:helpByStep.resultats,options:["Mat√©riels fonctionnels conformes aux sp√©cifications","Documentation compl√®te remise","Audit environnemental r√©alis√©","Remplacement automatique des √©quipements au bout d‚Äôun an"]},
      {id:"reception_ref",label:"R√©ception",help:helpByStep.reception_ref,options:["Contr√¥le technique des √©quipements","Possibilit√© de refus si colis non conforme","R√©ception automatique sans contr√¥le","D√©chargement effectu√© par le transporteur"]}
    ];
    case 1: return [
      {id:"objet",label:"Objet",help:helpByStep.objet,options:["Prestation de nettoyage int√©rieur des locaux du site TILESIA","P√©rim√®tre: bureaux, circulation, escaliers, ascenseur, sanitaires, vestiaires, r√©fectoires","Objectif: propret√©, hygi√®ne et confort des utilisateurs"]},
      {id:"contexte",label:"Contexte",help:helpByStep.contexte,options:["B√¢timent R+3, 4100 m¬≤, ~300 salari√©s","La politique sant√© s√©curit√© est un enjeu majeur pour l‚Äôentreprise","Locaux √©lectriques accompagn√©s par personnel habilit√©"]},
      {id:"definition",label:"D√©finition de la prestation",help:helpByStep.definition,options:["Nettoyage des sols (aspiration, balayage humide, lavage)","D√©poussi√©rage des surfaces et mobiliers","D√©sinfection des points de contact","Sanitaires: nettoyage, d√©sinfection et r√©assort"]},
      {id:"limites_titulaire",label:"Limites √† la charge du titulaire",help:helpByStep.limites_titulaire,options:["Approvisionnement consommables: papier toilette, essuie-mains, savon mains, sacs poubelles, d√©sodorisants","Fourniture mat√©riels et produits de nettoyage","Avis de passage apr√®s intervention"]},
      {id:"limites_entreprise",label:"Limites √† la charge de l‚Äôentreprise",help:helpByStep.limites_entreprise,options:["Mise √† disposition des locaux d‚Äôentretien et points d‚Äôeau","Accompagnement zones √©lectriques par agents habilit√©s","Acc√®s / badges / consignes de s√©curit√©"]},
      {id:"qualite",label:"Qualit√©",help:helpByStep.qualite,options:["Plan qualit√© et fiches techniques produits","Tra√ßabilit√© des interventions (registre / app)","Indicateurs de propret√© et plan d‚Äôam√©lioration"]},
      {id:"conditions",label:"Conditions d‚Äôintervention",help:helpByStep.conditions,options:["Respect s√©curit√© / environnement (tri, stockage produits)","Signalisation des zones en intervention","Interventions en heures ouvrables","D√©cret 92-158 & C. travail (R.237-1 √† R.237-28), normes d‚Äôhygi√®ne"]},
      {id:"resultats",label:"R√©sultats attendus",help:helpByStep.resultats,options:["Sols propres sans traces visibles","Sanitaires propres, d√©sinfect√©s et r√©approvisionn√©s","Mobilier d√©poussi√©r√©, points de contact d√©sinfect√©s"]},
      {id:"reception_ref",label:"R√©ception",help:helpByStep.reception_ref,options:["Rapport semestriel r√©dig√© par le service technique","Proc√®s-verbal sign√© et dat√© par les deux parties","R√©f√©rences: D√©cret 92-158 & C. travail (R.237-1 √† R.237-28), normes d‚Äôhygi√®ne"]}
    ];
    default: return [];
  }
}

/* Cl√©s (OK) */
const answerKeys = {
  4:{objet:[0,1,2],contexte:[0,1,2],definition:[0,1,2,3,5,6,7],limites_titulaire:[0,1,2],limites_entreprise:[0,1],qualite:[0,1,2],conditions:[0,1,2,3],resultats:[0,1,2],reception_ref:[0,1,2]},
  5:{objet:[0],contexte:[0,1,2],definition:[0,1,2],limites_titulaire:[0,1,2],limites_entreprise:[0,1,2],qualite:[0,1,2],conditions:[0,1,2],resultats:[0,1,2],reception_ref:[0,1,2]},
  6:{objet:[0],contexte:[0,3],definition:[0,1,2],limites_titulaire:[0,1,2],limites_entreprise:[0,1,2],qualite:[0,1,3],conditions:[0,1],resultats:[0,1,2],reception_ref:[0,1,3]},
  3:{objet:[0],contexte:[0,1,2],definition:[0,1],limites_titulaire:[0,1,2,3],limites_entreprise:[0],qualite:[0,1,2,3],conditions:[0,2,3],resultats:[0,1],reception_ref:[0,1,3]},
  1:{objet:[0],contexte:[0,1],definition:[0,1,2,3],limites_titulaire:[0,1],limites_entreprise:[0,1,2],qualite:[0,1,2],conditions:[0,1,2,3],resultats:[0,1,2],reception_ref:[0,1,2]}
};

function startBuilder(gameId, reset){
  const steps=stepsFor(gameId); if(!steps.length){alert("Assistant indisponible pour ce jeu.");return;}
  const c=document.getElementById('builderContainer'); if(reset) c.innerHTML='';
  const titles={1:"TILESA ‚Äî Jeu A",3:"LESATI ‚Äî Jeu B",4:"COPAYA ‚Äî Jeu A",5:"COPAYA ‚Äî Jeu B",6:"TILESA ‚Äî Jeu B"};
  c.innerHTML=`<h2>${titles[gameId]} ‚Äî Assistant (QCM)</h2>
    <div class="small">R√©diger votre CCTP avec votre assistant</div>
    <div class="progress"><span id="builderProgress"></span></div>
    <div class="tabs" id="builderTabs"></div>
    <div id="builderPanels"></div>
    <div class="warn" id="builderWarn">Veuillez s√©lectionner au moins un √©l√©ment dans cet onglet pour continuer.</div>
    <div class="step-actions" style="display:flex;gap:.5rem;justify-content:space-between;margin-top:1rem;flex-wrap:wrap">
      <div style="display:flex;gap:.5rem;flex-wrap:wrap">
        <button class="btn secondary" id="prevStep">‚óÄ Pr√©c√©dent</button>
        <button class="btn secondary" onclick="goTo('game'+gameId)">‚Üê Retour aux services</button>
        <button class="btn secondary" onclick="goTo('home')">üè† Retour accueil</button>
      </div>
      <div style="display:flex;gap:.5rem;flex-wrap:wrap">
        <button class="btn" id="nextStep">Suivant ‚ñ∂</button>
        <button class="btn" id="finishBuilder" style="display:none">G√©n√©rer le r√©sum√©</button>
      </div>
    </div>`;

  window._builderSelections=window._builderSelections||{}; window._builderIndex=0;
  const tabs=document.getElementById('builderTabs'); const panels=document.getElementById('builderPanels');
  steps.forEach((s,i)=>{const b=document.createElement('button');b.className='tab-btn'+(i===0?' active':'');b.textContent=`${i+1}. ${s.label}`;b.onclick=()=>goStep(i,steps.length);tabs.appendChild(b);
    const p=document.createElement('div');p.className='tab-panel'+(i===0?' active':'');p.id=`panel-${s.id}`;p.innerHTML=`<h3>${i+1}. ${s.label}</h3>
      <div class="help"><details><summary>Aide (facultatif)</summary><p>${s.help||""}</p></details></div>
      <div class="helper">S√©lectionnez les √©l√©ments <strong>corrects</strong> pour votre CCTP.</div>
      <div class="option-grid">${s.options.map((opt,idx)=>`<div class="option"><label><input type="checkbox" data-step="${s.id}" data-opt="${idx}"> ${opt}</label></div>`).join('')} </div>`;
    panels.appendChild(p);});
  panels.addEventListener('change',(e)=>{const box=e.target;if(box&&box.type==='checkbox'){const stepId=box.dataset.step;const idx=Number(box.dataset.opt);if(!window._builderSelections[stepId]) window._builderSelections[stepId]=new Set(); if(box.checked) window._builderSelections[stepId].add(idx); else window._builderSelections[stepId].delete(idx);}});
  document.getElementById('prevStep').onclick=()=>goStep(window._builderIndex-1,steps.length);
  document.getElementById('nextStep').onclick=()=>{if(!hasAtLeastOne(steps[window._builderIndex].id)){document.getElementById('builderWarn').style.display='block';return;}document.getElementById('builderWarn').style.display='none';goStep(window._builderIndex+1,steps.length);};
  document.getElementById('finishBuilder').onclick=()=>{if(!hasAtLeastOne(steps[window._builderIndex].id)){document.getElementById('builderWarn').style.display='block';return;}document.getElementById('builderWarn').style.display='none';finishBuilder(gameId,steps);};
  goStep(0,steps.length); goTo('builder');
}
function hasAtLeastOne(stepId){const set=window._builderSelections[stepId];return set&&set.size>0;}
function goStep(i,total){if(i<0||i>=total)return;window._builderIndex=i;[...document.querySelectorAll('#builderTabs .tab-btn')].forEach((b,k)=>b.classList.toggle('active',k===i));[...document.querySelectorAll('#builderPanels .tab-panel')].forEach(p=>p.classList.remove('active'));const activeId=document.querySelectorAll('#builderPanels .tab-panel')[i].id;document.getElementById(activeId).classList.add('active');const pct=Math.round((i)/(total-1)*100);document.getElementById('builderProgress').style.width=pct+'%';document.getElementById('prevStep').disabled=(i===0);document.getElementById('nextStep').style.display=(i===total-1)?'none':'inline-block';document.getElementById('finishBuilder').style.display=(i===total-1)?'inline-block':'none';}
function levelBadge(pct){if(pct<50)return{label:"D√©butant",cls:"debutant"};if(pct<75)return{label:"Avanc√©",cls:"avance"};if(pct<90)return{label:"Expert",cls:"expert"};return{label:"G√©nie",cls:"genie"};}
function finishBuilder(gameId,steps){let html='<h2>R√©sum√©</h2>';steps.forEach((s,i)=>{const picked=[...(window._builderSelections[s.id]||[])].sort((a,b)=>a-b);if(picked.length){html+=`<h4>${i+1}. ${s.label}</h4><ul>`;picked.forEach(idx=>html+=`<li>${s.options[idx]}</li>`);html+='</ul>';}});const keyMap=answerKeys[gameId];let totalCorrect=0,selectedCorrect=0;const errors=[];for(const step of steps){const key=keyMap[step.id]||[];totalCorrect+=key.length;const picked=window._builderSelections[step.id]?Array.from(window._builderSelections[step.id]):[];const ok=picked.filter(i=>key.includes(i));const wrong=picked.filter(i=>!key.includes(i));const missed=key.filter(i=>!picked.includes(i));selectedCorrect+=ok.length;if(wrong.length||missed.length){errors.push({label:step.label,wrong:wrong.map(i=>step.options[i]),missed:missed.map(i=>step.options[i])});}}const pct=totalCorrect?Math.round((selectedCorrect/totalCorrect)*100):0;const level=levelBadge(pct);html+=`<div class="score" style="display:block">Score : ${selectedCorrect} sur ${totalCorrect} (${pct}%) <span class="badge ${level.cls}">${level.label}</span></div>`;if(errors.length){html+=`<button class="btn secondary" id="toggleErrors">Voir mes fautes</button>`;html+=`<div class="errors" id="errorsPanel">`+errors.map(e=>{let b=`<div style="margin:.4rem 0">`;b+=`<h4>${e.label}</h4>`;if(e.wrong.length)b+=`<div style="color:#b91c1c"><strong>Choix FAUX :</strong><ul>${e.wrong.map(t=>`<li>${t}</li>`).join('')}</ul></div>`;if(e.missed.length)b+=`<div style="color:#92400e"><strong>Mauvaises r√©ponses :</strong><ul>${e.missed.map(t=>`<li>${t}</li>`).join('')}</ul></div>`;b+=`</div>`;return b;}).join('')+`</div>`;}html+=`<div style="display:flex;gap:.5rem;margin-top:12px;flex-wrap:wrap"><button class="btn secondary" onclick="startBuilder(${gameId},true)">Modifier</button><button class="btn" onclick="goTo('game${gameId}')">Retour √† la carte</button><button class="btn secondary" onclick="goTo('home')">üè† Retour accueil</button></div>`;document.getElementById('summaryContainer').innerHTML=html;goTo('summary');const t=document.getElementById('toggleErrors'),panel=document.getElementById('errorsPanel');if(t&&panel){t.onclick=()=>{panel.style.display=(panel.style.display==='none'||panel.style.display==='')?'block':'none';t.textContent=panel.style.display==='none'?'Voir mes fautes':'Masquer mes fautes';};panel.style.display='none';}}
</script>
</body>
</html>
